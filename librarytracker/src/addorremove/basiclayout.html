<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Book Collection</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vintage': {
                            dark: '#1a1a1a',
                            light: '#d9c7a6',
                            border: '#3a2c2c',
                            paper: '#efebe9',
                        },
                        'mystery': {
                            dark: '#0d0d0d',
                        },
                        'christie': {
                            blue: '#2c3e50',
                        },
                        'bond': {
                            green: '#2e7d32',
                        },
                        'rowling': {
                            purple: '#5d4037',
                        }
                    },
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'crimson': ['Crimson Text', 'serif'],
                        'playfair': ['Playfair Display', 'serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .form-bg {
            background-image: linear-gradient(rgba(12,12,12,0.45), rgba(12,12,12,0.45)), url("../../public/assets/books/bgimages/hand-drawn-coffee-concept-background-free-vector.jpg");
            background-size: cover;
            background-position: center;
            color: #fff;
        }
        .form-bg label,
        .form-bg input,
        .form-bg select,
        .form-bg textarea,
        .form-bg button {
            color: inherit;
        }
        .form-bg .vintage-border {
            border-color: rgba(255,255,255,0.12);
        }
        body {
            background-image: url("../../public/assets/books/bgimages/bgm3.webp");
            background-repeat: no-repeat;
            background-size: cover;
            background-position:center;
        }
        .book-card {
            transition: all 0.3s ease;
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(26, 26, 26, 0.2);
        }
        .vintage-border {
            border: 1px solid #3a2c2c;
            box-shadow: 0 4px 8px rgba(26, 26, 26, 0.1);
        }
        .page-turn {
            transition: transform 0.5s ease;
        }
        .page-turn:hover {
            transform: rotateY(10deg);
        }
    </style>
</head>
<body class="bg-vintage-paper font-crimson min-h-screen py-8 px-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-12 relative">
            <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 w-24 h-1 bg-vintage-border"></div>
            <h1 class="text-4xl md:text-5xl font-bold text-vintage-dark font-cinzel mb-2 tracking-wide">The Mysterious Library</h1>
            <p class="text-lg text-vintage-dark italic font-playfair">Curate your collection of literary treasures</p>
            <div class="flex justify-center mt-4 space-x-2">
                <span class="w-3 h-3 rounded-full bg-christie-blue"></span>
                <span class="w-3 h-3 rounded-full bg-bond-green"></span>
                <span class="w-3 h-3 rounded-full bg-rowling-purple"></span>
            </div>
            
            
            <div class="mt-6">
                <a href="../../index.html" id="backToHome" class="inline-flex items-center text-vintage-dark hover:text-vintage-border transition-colors duration-300 font-playfair">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Home
                </a>
            </div>
        </header>

        <div class="flex flex-col lg:flex-row gap-8">
            
            <div class="lg:w-2/5">
                <div class="bg-vintage-light vintage-border rounded-lg p-6 sticky top-8 page-turn">
                    <h2 class="text-2xl font-bold text-vintage-dark mb-6 text-center font-cinzel tracking-wider">Add New Volume</h2>
                    
                    <form id="bookForm" class="space-y-4">
                        <div>
                            <label class="block text-vintage-dark font-semibold mb-1 font-playfair">Book Title</label>
                            <input type="text" id="title" class="w-full px-4 py-2 bg-vintage-paper border border-vintage-border rounded focus:outline-none focus:ring-1 focus:ring-vintage-dark" placeholder="Enter book title" required>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-vintage-dark font-semibold mb-1 font-playfair">Author</label>
                                <input type="text" id="author" class="w-full px-4 py-2 bg-vintage-paper border border-vintage-border rounded focus:outline-none focus:ring-1 focus:ring-vintage-dark" placeholder="Author name" required>
                            </div>
                            
                            <div>
                                <label class="block text-vintage-dark font-semibold mb-1 font-playfair">Year Published</label>
                                <input type="number" id="year" min="1000" max="2023" class="w-full px-4 py-2 bg-vintage-paper border border-vintage-border rounded focus:outline-none focus:ring-1 focus:ring-vintage-dark" placeholder="e.g., 1925">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-vintage-dark font-semibold mb-1 font-playfair">Genre</label>
                            <select id="genre" class="w-full px-4 py-2 bg-vintage-paper border border-vintage-border rounded focus:outline-none focus:ring-1 focus:ring-vintage-dark">
                                <option value="Mystery">Mystery</option>
                                <option value="Classic">Classic</option>
                                <option value="Fiction">Fiction</option>
                                <option value="Non-Fiction">Non-Fiction</option>
                                <option value="Science Fiction">Science Fiction</option>
                                <option value="Fantasy">Fantasy</option>
                                <option value="Romance">Romance</option>
                                <option value="Historical">Historical</option>
                                <option value="Biography">Biography</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-vintage-dark font-semibold mb-1 font-playfair">Description</label>
                            <textarea id="description" rows="3" class="w-full px-4 py-2 bg-vintage-paper border border-vintage-border rounded focus:outline-none focus:ring-1 focus:ring-vintage-dark" placeholder="Brief description of the book"></textarea>
                        </div>
                        
                        <button type="submit" id="submit" class="w-full bg-vintage-dark hover:bg-mystery-dark text-vintage-light font-semibold py-2 px-4 rounded transition duration-300 transform hover:-translate-y-1 font-playfair tracking-wide">
                            Add to Collection
                        </button>
                    </form>
                    
                    <div class="mt-8 pt-6 border-t border-vintage-border border-dashed">
                        <h3 class="text-lg font-bold text-vintage-dark mb-4 text-center font-cinzel">Collection Stats</h3>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div class="bg-vintage-paper p-3 rounded vintage-border">
                                <p class="text-2xl font-bold text-christie-blue" id="totalBooks">0</p>
                                <p class="text-sm text-vintage-dark font-playfair">Total Books</p>
                            </div>
                            <div class="bg-vintage-paper p-3 rounded vintage-border">
                                <p class="text-2xl font-bold text-bond-green" id="oldestBook">-</p>
                                <p class="text-sm text-vintage-dark font-playfair">Oldest Book</p>
                            </div>
                            <div class="bg-vintage-paper p-3 rounded vintage-border">
                                <p class="text-2xl font-bold text-rowling-purple" id="genresCount">0</p>
                                <p class="text-sm text-vintage-dark font-playfair">Genres</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <div class="lg:w-3/5">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0">
                    <h2 class="text-2xl font-bold text-vintage-dark font-cinzel tracking-wide">Your Collection</h2>
                    <div class="flex space-x-4 w-full md:w-auto">
                        <div class="relative flex-1 md:flex-none">
                            <input type="text" id="searchInput" placeholder="Search books..." class="w-full pl-10 pr-4 py-2 bg-vintage-paper border border-vintage-border rounded focus:outline-none focus:ring-1 focus:ring-vintage-dark">
                            <svg class="w-5 h-5 text-vintage-dark absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <select id="genreFilter" class="bg-vintage-paper border border-vintage-border rounded px-4 py-2 focus:outline-none focus:ring-1 focus:ring-vintage-dark">
                            <option value="all">All Genres</option>
                            <option value="Mystery">Mystery</option>
                            <option value="Classic">Classic</option>
                            <option value="Fiction">Fiction</option>
                            <option value="Non-Fiction">Non-Fiction</option>
                            <option value="Science Fiction">Science Fiction</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="Romance">Romance</option>
                            <option value="Historical">Historical</option>
                            <option value="Biography">Biography</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div id="bookCollection" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div class="col-span-full text-center py-12 text-vintage-dark italic font-playfair border-2 border-dashed border-vintage-border rounded-lg">
                        <svg class="w-16 h-16 mx-auto text-vintage-border mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <p class="text-xl">Your collection awaits its first volume</p>
                        <p class="mt-2">Add a book to begin your literary journey</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let books = [];
const form = document.getElementById("bookForm");
const submit = document.getElementById("submit");
const totalBooksEl = document.getElementById("totalBooks"); 
const oldestBookEl = document.getElementById("oldestBook"); 
const genresCountEl = document.getElementById("genresCount"); 
const searchInput = document.getElementById("searchInput");
const genreFilter = document.getElementById("genreFilter");
const bookCollection = document.getElementById("bookCollection");


document.addEventListener('DOMContentLoaded', function() {
    // Load books from server
    fetch('/api/books')
        .then(r => r.json())
        .then(result => {
            if (result.success) {
                books = result.data.map(b => ({
                    id: b._id,
                    title: b.title,
                    author: b.author,
                    year: b.year,
                    genre: b.genre,
                    description: b.description
                }));
            }
            renderBooks();
            updateStats();
        })
        .catch(err => {
            console.error('Failed to load books:', err);
            renderBooks();
            updateStats();
        });
});


form.addEventListener("submit", function(e) {
    e.preventDefault();
    addBook();
});

searchInput.addEventListener('input', function() {
    filterBooks(); 
});

genreFilter.addEventListener('change', function() {
    filterBooks(); 
});

function addBook() {
    const title = document.getElementById("title").value;
    const author = document.getElementById("author").value;
    const year = document.getElementById("year").value;
    const genre = document.getElementById("genre").value;
    const description = document.getElementById("description").value; 
    const payload = { title, author, year, genre, description };

    fetch('/api/books', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(result => {
        if (result.success && result.data) {
            const b = result.data;
            const newbook = {
                id: b._id,
                title: b.title,
                author: b.author,
                year: b.year,
                genre: b.genre,
                description: b.description
            };
            books.unshift(newbook);
            renderBooks();
            updateStats();
            form.reset();
            showNotification(`${title} has been added to your collection`);
        } else {
            showNotification('Failed to add book');
        }
    })
    .catch(err => {
        console.error('Error adding book:', err);
        showNotification('Error adding book');
    });
}

function removeBook(id) {
    const book = books.find(b => b.id === id);
    if (!book) return;
    if (!confirm(`Are you sure you want to remove ${book.title} from your collection`)) return;

    fetch(`/api/books/${id}`, { method: 'DELETE' })
        .then(r => r.json())
        .then(result => {
            if (result.success) {
                books = books.filter(b => b.id !== id);
                renderBooks();
                updateStats();
                showNotification(`${book.title} has been removed from your collection`);
            } else {
                showNotification('Failed to remove book');
            }
        })
        .catch(err => {
            console.error('Error deleting book:', err);
            showNotification('Error removing book');
        });
}

function renderBooks(booksToRender = books) {
    if (booksToRender.length === 0) {
        bookCollection.innerHTML = `
            <div class="col-span-full text-center py-12 text-vintage-dark italic font-playfair border-2 border-dashed border-vintage-border rounded-lg">
                <svg class="w-16 h-16 mx-auto text-vintage-border mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
                <p class="text-xl">No books match your search</p>
                <p class="mt-2">Try adjusting your search or filter</p>
            </div>
        `;
        return;
    }
    
    bookCollection.innerHTML = booksToRender.map(book => `
        <div class="book-card bg-vintage-light vintage-border rounded-lg p-4 flex flex-col h-full">
            <div class="flex justify-between items-start mb-2">
                <h3 class="text-xl font-bold text-vintage-dark font-cinzel truncate flex-1">${book.title}</h3>
                <button onclick="removeBook('${book.id}')" class="text-vintage-dark hover:text-vintage-border transition-colors ml-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
            </div>
            <p class="text-vintage-dark mb-1 font-playfair"><span class="font-semibold">Author:</span> ${book.author}</p>
            <p class="text-vintage-dark mb-1 font-playfair"><span class="font-semibold">Year:</span> ${book.year}</p>
            <p class="text-vintage-dark mb-3 font-playfair"><span class="font-semibold">Genre:</span> 
                <span class="inline-block px-2 py-1 text-xs rounded ml-1 ${
                    book.genre === 'Mystery' ? 'bg-christie-blue text-vintage-light' : 
                    book.genre === 'Classic' ? 'bg-bond-green text-vintage-light' : 
                    book.genre === 'Fantasy' ? 'bg-rowling-purple text-vintage-light' : 
                    'bg-vintage-dark text-vintage-light'
                }">${book.genre}</span>
            </p>
            <p class="text-vintage-dark text-sm flex-grow font-crimson">${book.description || 'No description provided.'}</p>
            <div class="mt-4 pt-3 border-t border-vintage-border border-dashed text-right">
                <span class="inline-block bg-vintage-paper text-vintage-dark text-xs px-2 py-1 rounded vintage-border font-mono">ID: ${book.id}</span>
            </div>
        </div>
    `).join('');
}

function filterBooks() { 
    const searchbook = searchInput.value.toLowerCase();
    const genrevalue = genreFilter.value;

    const filteredBooks = books.filter(book => { 
        const matchesSearch = (
            book.title.toLowerCase().includes(searchbook) ||
            book.author.toLowerCase().includes(searchbook) ||
            book.genre.toLowerCase().includes(searchbook)
        );
        const genrematch = genrevalue === 'all' || book.genre === genrevalue;
        return matchesSearch && genrematch;
    });
    
    renderBooks(filteredBooks); 
}

function updateStats() {
    totalBooksEl.textContent = books.length;
    
    const genres = [...new Set(books.map(book => book.genre))];
    genresCountEl.textContent = genres.length;
    
    if (books.length > 0) {
        const years = books
            .map(book => book.year)
            .filter(year => year !== 'Unknown' && !isNaN(year))
            .map(year => parseInt(year));
        
        if (years.length > 0) {
            const oldestYear = Math.min(...years);
            oldestBookEl.textContent = oldestYear;
        } else {
            oldestBookEl.textContent = '-';
        }
    } else {
        oldestBookEl.textContent = '-';
    }
}

function showNotification(message) { 
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    const notification = document.createElement('div');
    notification.className = 'notification fixed top-4 right-4 bg-vintage-dark text-vintage-light px-6 py-3 rounded shadow-lg transform translate-x-full transition-transform duration-300 z-50 font-playfair';
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 10);
    
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

        
    </script>
</body>
</html>