<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gruvbox-bg': '#282828',
                        'gruvbox-bg-soft': '#32302f',
                        'gruvbox-fg': '#ebdbb2',
                        'gruvbox-red': '#cc241d',
                        'gruvbox-green': '#98971a',
                        'gruvbox-yellow': '#d79921',
                        'gruvbox-blue': '#458588',
                        'gruvbox-purple': '#b16286',
                        'gruvbox-aqua': '#689d6a',
                        'gruvbox-orange': '#d65d0e',
                        'gruvbox-gray': '#928374',
                        'gruvbox-light-bg': '#3c3836',
                        'gruvbox-lighter-bg': '#504945',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gruvbox-bg min-h-screen py-8 flex justify-center items-center">
    <!-- Back Navigation -->
    <div class="fixed top-4 left-4 z-20">
        <a href="../../index.html"
            class="flex items-center gap-2 px-4 py-2 bg-gruvbox-bg-soft hover:bg-gruvbox-light-bg text-gruvbox-fg rounded-lg border border-gruvbox-gray transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18">
                </path>
            </svg>
            Back to Home
        </a>
    </div>
    <!-- Search Bar -->
    <div class="fixed top-4 left-1/2 transform -translate-x-1/2 z-10">
        <div class="bg-gruvbox-bg-soft rounded-lg shadow-lg border border-gruvbox-lighter-bg p-4">
            <div class="flex gap-2">
                <input type="text" id="bookSearchInput"
                    placeholder="Search for a book (e.g., 'Pride and Prejudice Jane Austen')"
                    class="px-4 py-2 bg-gruvbox-light-bg text-gruvbox-fg border border-gruvbox-gray rounded-lg focus:outline-none focus:border-gruvbox-blue w-80">
                <button id="searchBtn"
                    class="px-6 py-2 bg-gruvbox-blue hover:bg-gruvbox-aqua text-gruvbox-fg font-semibold rounded-lg transition-colors">
                    Search
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-20">
        <div class="bg-gruvbox-bg-soft rounded-xl shadow-lg overflow-hidden border border-gruvbox-lighter-bg">
            <div class="flex flex-col lg:flex-row">
                <!-- Book Image Section -->
                <div class="lg:w-1/3 p-6 lg:p-8">
                    <div class="sticky top-8">
                        <div
                            class="aspect-[3/4] bg-gruvbox-lighter-bg rounded-lg overflow-hidden mb-4 border border-gruvbox-gray">
                            <img id="bookImage" src="../../public/assets/books/agathacristie/murderonorient.jpg"
                                alt="Book Cover" class="w-full h-full object-cover">
                        </div>

                        <!-- Action Buttons -->
                        <div class="space-y-3">
                            <button
                                class="w-full bg-gruvbox-green hover:bg-green-700 text-gruvbox-bg font-semibold py-3 px-6 rounded-lg transition-colors">
                                Want to Read
                            </button>
                            <button
                                class="w-full border-2 border-gruvbox-gray hover:border-gruvbox-fg text-gruvbox-fg font-semibold py-3 px-6 rounded-lg transition-colors hover:bg-gruvbox-light-bg">
                                Buy on Amazon
                            </button>
                        </div>

                        <!-- Rating Section -->
                        <div class="mt-6 text-center">
                            <div class="flex justify-center mb-2">
                                <div class="flex space-x-1" id="starRating">
                                    <!-- Stars will be generated by JavaScript -->
                                </div>
                            </div>
                            <p class="text-sm text-gruvbox-gray">Rate this book</p>
                        </div>
                    </div>
                </div>

                <!-- Book Details Section -->
                <div class="lg:w-2/3 p-6 lg:p-8">
                    <div class="mb-4">
                        <h1 id="bookTitle" class="text-3xl lg:text-4xl font-bold text-gruvbox-fg mb-2">
                            Murder On The Orient Express
                        </h1>
                        <p id="authorName" class="text-lg text-gruvbox-gray mb-4">
                            Agatha Christie
                        </p>

                        <!-- Rating and Stats -->
                        <div class="flex items-center gap-4 mb-6">
                            <div class="flex items-center">
                                <div class="flex text-gruvbox-yellow mr-2" id="displayStars">
                                    <!-- Display stars will be generated by JavaScript -->
                                </div>
                                <span id="ratingScore" class="text-xl font-semibold text-gruvbox-fg">4.5</span>
                            </div>
                            <span id="ratingCount" class="text-gruvbox-gray">33,549 ratings</span>
                        </div>
                    </div>

                    <!-- Book Description -->
                    <div class="mb-6">
                        <p id="bookDescription" class="text-gruvbox-fg leading-relaxed text-base">

                        </p>
                        <button id="showMoreBtn"
                            class="text-gruvbox-blue hover:text-gruvbox-aqua font-medium mt-2 transition-colors">
                            Show more
                        </button>
                    </div>

                    <!-- Genres -->
                    <div class="mb-6">
                        <p class="text-sm text-gruvbox-gray mb-2">Genres</p>
                        <div class="flex flex-wrap gap-2" id="genreContainer">
                            <!-- Genres will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Book Info -->
                    <div class="mb-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gruvbox-gray">Pages:</span>
                                <span id="pageCount" class="ml-2 text-gruvbox-fg">295 pages, ebook</span>
                            </div>
                            <div>
                                <span class="text-gruvbox-gray">First published:</span>
                                <span id="publishDate" class="ml-2 text-gruvbox-fg">January 1, 2009</span>
                            </div>
                        </div>
                    </div>


                    <!-- About the Author -->
                    <div class="border-t border-gruvbox-lighter-bg pt-6 mt-6">
                        <h3 class="text-xl font-semibold text-gruvbox-fg mb-4">About the author</h3>
                        <div class="flex items-start gap-4">
                            <div
                                class="w-16 h-16 bg-gruvbox-lighter-bg rounded-full flex-shrink-0 overflow-hidden border border-gruvbox-gray">
                                <img id="authorImage" src="../../public/assets/books/agathacristie/theauthor.jpg"
                                    alt="Author" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 id="authorNameFull" class="font-semibold text-gruvbox-fg">Agatha Christie</h4>
                                </div>
                                <p class="text-sm text-gruvbox-gray mb-2">
                                    <span id="bookCount">60+</span>
                                </p>
                                <p id="authorBio" class="text-sm text-gruvbox-fg leading-relaxed">
                                    Born in Torquay in 1890, Agatha Christie began writing during the First World War
                                    and wrote over 100 novels, plays and
                                    short story collections. She was still writing to great acclaim until her death, and
                                    her books have now sold over a
                                    billion copies in English and another billion in over 100 foreign languages. Yet
                                    Agatha Christie was always a very
                                    private person, and though Hercule Poirot and Miss Marple became household names,
                                    the Queen of Crime was a complete
                                    enigma to all but her closest friends.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentBookDescription = '';
        let isDescriptionExpanded = false;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function () {
            // Load book data for "Murder on the Orient Express" by default
            searchAndLoadBook('Murder on the Orient Express Agatha Christie');
            
            generateStars();
            setupShowMore();
            setupBookSearch();
        });

        // Setup book search functionality
        function setupBookSearch() {
            const searchInput = document.getElementById('bookSearchInput');
            const searchBtn = document.getElementById('searchBtn');

            searchBtn.addEventListener('click', function () {
                const query = searchInput.value.trim();
                if (query) {
                    searchAndLoadBook(query);
                }
            });

            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        searchAndLoadBook(query);
                    }
                }
            });
        }

        // Google Books API functions
        function searchAndLoadBook(query) {
            showLoadingState(); 
            const xhr = new XMLHttpRequest();
            const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=10`;

            xhr.open('GET', url, true);
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);

                            if (data.items && data.items.length > 0) {
                                let selectedBook = data.items[0]; 
                                for (let i = 0; i < data.items.length; i++) {
                                    const book = data.items[i];
                                    if (book.volumeInfo.averageRating && book.volumeInfo.ratingsCount) {
                                        selectedBook = book;
                                        break;
                                    }
                                }

                                updateBookDataFromAPI(selectedBook);
                            } else {
                                showErrorState('No books found for that search query.');
                            }
                        } catch (error) {
                            console.error('Error parsing book data:', error);
                            showErrorState('Error parsing book data. Please try again.');
                        }
                    } else {
                        console.error('Network error:', xhr.status, xhr.statusText);
                        showErrorState('Error fetching book data. Please try again.');
                    }
                }
            };

            xhr.onerror = function() {
                console.error('XMLHttpRequest error occurred');
                showErrorState('Error fetching book data. Please try again.');
            };

            xhr.send();
        }

        function showLoadingState() {
            document.getElementById('bookTitle').textContent = 'Loading...';
            document.getElementById('authorName').textContent = 'Searching for book...';
            document.getElementById('bookDescription').textContent = 'Please wait while we fetch book information...';
            document.getElementById('authorNameFull').textContent = 'Loading author...';
            document.getElementById('authorBio').textContent = 'Loading author information...';
            document.getElementById('bookCount').textContent = 'Loading...';
            document.getElementById('ratingScore').textContent = '...';
            document.getElementById('ratingCount').textContent = 'Loading...';
            document.getElementById('pageCount').textContent = 'Loading...';
            document.getElementById('publishDate').textContent = 'Loading...';
            document.getElementById('genreContainer').innerHTML = '<span class="text-gruvbox-gray">Loading genres...</span>';
            document.getElementById('displayStars').innerHTML = '';
            document.getElementById('starRating').innerHTML = '';
            
        }

        function showErrorState(message) {
            document.getElementById('bookTitle').textContent = 'Book Not Found';
            document.getElementById('authorName').textContent = 'Unknown Author';
            document.getElementById('bookDescription').textContent = message || 'Sorry, we couldn\'t find information for this book. Please try a different search term.';
            document.getElementById('authorNameFull').textContent = 'Unknown Author';
            document.getElementById('authorBio').textContent = 'Author information not available.';
            document.getElementById('bookCount').textContent = 'N/A';
            document.getElementById('ratingScore').textContent = 'N/A';
            document.getElementById('ratingCount').textContent = 'No ratings';
            document.getElementById('pageCount').textContent = 'Unknown';
            document.getElementById('publishDate').textContent = 'Unknown';
            document.getElementById('genreContainer').innerHTML = '<span class="text-gruvbox-gray">No genres available</span>';
            document.getElementById('displayStars').innerHTML = '';
            document.getElementById('starRating').innerHTML = '';
        }

        function updateBookDataFromAPI(book) {
            const volumeInfo = book.volumeInfo;
            
            // Update basic book information
            document.getElementById('bookTitle').textContent = volumeInfo.title || 'Unknown Title';
            document.getElementById('authorName').textContent = volumeInfo.authors ? volumeInfo.authors.join(', ') : 'Unknown Author';
            
            // Update book image
            if (volumeInfo.imageLinks && volumeInfo.imageLinks.thumbnail) {
                document.getElementById('bookImage').src = volumeInfo.imageLinks.thumbnail.replace('http:', 'https:');
            }
            
            // Update description
            currentBookDescription = volumeInfo.description || 'No description available for this book.';
            updateDescription();
            
            // Update rating information
            const rating = volumeInfo.averageRating || 0;
            const ratingCount = volumeInfo.ratingsCount || 0;
            
            document.getElementById('ratingScore').textContent = rating ? rating.toFixed(1) : 'N/A';
            document.getElementById('ratingCount').textContent = ratingCount ? `${ratingCount.toLocaleString()} ratings` : 'No ratings';
            
            updateDisplayStars(rating);
            
            // Update page count and publish date
            document.getElementById('pageCount').textContent = volumeInfo.pageCount ? `${volumeInfo.pageCount} pages` : 'Unknown pages';
            document.getElementById('publishDate').textContent = volumeInfo.publishedDate || 'Unknown date';
            
            // Update genres
            updateGenresFromAPI(volumeInfo.categories);
            
            // Update author information
            updateAuthorInformation(volumeInfo);
            
            // Regenerate interactive stars
            generateStars();
        }

        function updateAuthorInformation(volumeInfo) {
            const authorName = volumeInfo.authors ? volumeInfo.authors[0] : 'Unknown Author';
            document.getElementById('authorNameFull').textContent = authorName;
            
            // Try to fetch author biography from a simple source
            fetchAuthorBiography(authorName, function(bio, bookCount) {
                if (bio) {
                    document.getElementById('authorBio').textContent = bio;
                    document.getElementById('bookCount').textContent = bookCount || 'Multiple books';
                } else {
                    updateAuthorFallback(volumeInfo);
                }
            });
        }

        function fetchAuthorBiography(authorName, callback) {
            // For demo purposes, we'll use some predefined author information
            const knownAuthors = {
                'Agatha Christie': {
                    bio: 'Born in Torquay in 1890, Agatha Christie began writing during the First World War and wrote over 100 novels, plays and short story collections. She was still writing to great acclaim until her death, and her books have now sold over a billion copies in English and another billion in over 100 foreign languages. Yet Agatha Christie was always a very private person, and though Hercule Poirot and Miss Marple became household names, the Queen of Crime was a complete enigma to all but her closest friends.',
                    bookCount: '66 books'
                },
                'Jane Austen': {
                    bio: 'Jane Austen was an English novelist known primarily for her six major novels, which interpret, critique and comment upon the British landed gentry at the end of the 18th century. Her novels are noted for their wit, sharp social commentary, and realistic portrayal of domestic life.',
                    bookCount: '6 major novels'
                },
                'George Orwell': {
                    bio: 'George Orwell was an English novelist, essayist, journalist and critic. His work is characterized by lucid prose, biting social criticism, opposition to totalitarianism, and outspoken support of democratic socialism.',
                    bookCount: '9 books'
                },
                'J.K. Rowling': {
                    bio: 'J.K. Rowling is a British author and philanthropist. She is best known for writing the Harry Potter fantasy series, which has won multiple awards and sold more than 500 million copies, becoming the best-selling book series in history.',
                    bookCount: '14+ books'
                }
            };
            
            const authorInfo = knownAuthors[authorName];
            if (authorInfo) {
                callback(authorInfo.bio, authorInfo.bookCount);
            } else {
                
                fetchAuthorDetails(authorName, callback);
            }
        }

        function fetchAuthorDetails(authorName, callback) {
           
            const xhr = new XMLHttpRequest();
            const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(authorName)}`;
            
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);
                            const extract = data.extract;
                            if (extract && extract.length > 50) {
                                callback(extract, 'Multiple books');
                                return;
                            }
                        } catch (error) {
                            console.log('Wikipedia API failed, using fallback');
                        }
                    }
                    callback(null, null);
                }
            };
            xhr.onerror = function() {
                callback(null, null);
            };
            xhr.send();
        }

        function updateAuthorFallback(volumeInfo) {
            document.getElementById('authorBio').textContent = 'Author biography not available.';
            document.getElementById('bookCount').textContent = 'Multiple books';
        }

        function updateDisplayStars(rating) {
            const starsContainer = document.getElementById('displayStars');
            starsContainer.innerHTML = '';
            
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const totalStars = 5;
            
            for (let i = 0; i < fullStars; i++) {
                starsContainer.innerHTML += '★';
            }
            
            if (hasHalfStar) {
                starsContainer.innerHTML += '☆';
            }
            
            for (let i = fullStars + (hasHalfStar ? 1 : 0); i < totalStars; i++) {
                starsContainer.innerHTML += '☆';
            }
        }

        function updateGenresFromAPI(categories) {
            const genreContainer = document.getElementById('genreContainer');
            
            if (categories && categories.length > 0) {
                genreContainer.innerHTML = '';
                categories.forEach(category => {
                    const genreSpan = document.createElement('span');
                    genreSpan.className = 'px-3 py-1 bg-gruvbox-light-bg text-gruvbox-fg text-sm rounded-full border border-gruvbox-gray';
                    genreSpan.textContent = category;
                    genreContainer.appendChild(genreSpan);
                });
            } else {
                genreContainer.innerHTML = '<span class="text-gruvbox-gray">No genres available</span>';
            }
        }

        // Generate interactive rating stars
        function generateStars() {
            const starContainer = document.getElementById('starRating');
            starContainer.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('button');
                star.innerHTML = '☆';
                star.className = 'text-2xl text-gruvbox-gray hover:text-gruvbox-yellow transition-colors';
                star.addEventListener('click', function() {
                    updateStarRating(i);
                });
                star.addEventListener('mouseenter', function() {
                    highlightStars(i);
                });
                starContainer.appendChild(star);
            }
            
            starContainer.addEventListener('mouseleave', function() {
                resetStarHighlight();
            });
        }

        function updateStarRating(rating) {
            const stars = document.querySelectorAll('#starRating button');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.innerHTML = '★';
                    star.className = 'text-2xl text-gruvbox-yellow transition-colors';
                } else {
                    star.innerHTML = '☆';
                    star.className = 'text-2xl text-gruvbox-gray hover:text-gruvbox-yellow transition-colors';
                }
            });
        }

        function highlightStars(rating) {
            const stars = document.querySelectorAll('#starRating button');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.innerHTML = '★';
                    star.className = 'text-2xl text-gruvbox-yellow transition-colors';
                } else {
                    star.innerHTML = '☆';
                    star.className = 'text-2xl text-gruvbox-gray hover:text-gruvbox-yellow transition-colors';
                }
            });
        }

        function resetStarHighlight() {
            const stars = document.querySelectorAll('#starRating button');
            stars.forEach(star => {
                star.innerHTML = '☆';
                star.className = 'text-2xl text-gruvbox-gray hover:text-gruvbox-yellow transition-colors';
            });
        }

        function setupShowMore() {
            const showMoreBtn = document.getElementById('showMoreBtn');
            showMoreBtn.addEventListener('click', function() {
                isDescriptionExpanded = !isDescriptionExpanded;
                updateDescription();
            });
        }

        function updateDescription() {
            const descriptionElement = document.getElementById('bookDescription');
            const showMoreBtn = document.getElementById('showMoreBtn');
            
            if (!currentBookDescription) {
                descriptionElement.textContent = 'No description available.';
                showMoreBtn.style.display = 'none';
                return;
            }
            
            const maxLength = 300;
            
            if (currentBookDescription.length <= maxLength) {
                descriptionElement.textContent = currentBookDescription;
                showMoreBtn.style.display = 'none';
            } else {
                if (isDescriptionExpanded) {
                    descriptionElement.textContent = currentBookDescription;
                    showMoreBtn.textContent = 'Show less';
                } else {
                    descriptionElement.textContent = currentBookDescription.substring(0, maxLength) + '...';
                    showMoreBtn.textContent = 'Show more';
                }
                showMoreBtn.style.display = 'inline';
            }
        }

       
        function generateGenres() {
           
            const genres = ['Mystery', 'Fiction', 'Classic'];
            const genreContainer = document.getElementById('genreContainer');
            
            if (genreContainer.children.length === 0) {
                genreContainer.innerHTML = '';
                genres.forEach(genre => {
                    const genreSpan = document.createElement('span');
                    genreSpan.className = 'px-3 py-1 bg-gruvbox-light-bg text-gruvbox-fg text-sm rounded-full border border-gruvbox-gray';
                    genreSpan.textContent = genre;
                    genreContainer.appendChild(genreSpan);
                });
            }
        }

        
        function searchBook(title, author = '') {
            const query = author ? `${title} ${author}` : title;
            searchAndLoadBook(query);
        }

        function updateBookData(bookData) {
            
            if (bookData.volumeInfo) {
                updateBookDataFromAPI(bookData);
            }
        }
    </script>
</body>

</html>